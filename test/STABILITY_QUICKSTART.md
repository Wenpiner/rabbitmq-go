# ç¨³å®šæ€§æµ‹è¯•å¿«é€Ÿå¼€å§‹

5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ RabbitMQ-Go ç¨³å®šæ€§æµ‹è¯•ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•

```bash
# ä½¿ç”¨ Make å‘½ä»¤
make stability-long-run

# æˆ–ä½¿ç”¨è„šæœ¬
./scripts/run-stability-tests.sh long-run
```

è¿™å°†å¯åŠ¨:
- âœ… RabbitMQ æœåŠ¡å™¨
- âœ… Prometheus ç›‘æ§
- âœ… Grafana å¯è§†åŒ–
- âœ… é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•å®¹å™¨

### 2. æŸ¥çœ‹æµ‹è¯•çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
make stability-status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
make stability-logs
```

### 3. æ‰“å¼€ç›‘æ§é¢æ¿

```bash
# è‡ªåŠ¨æ‰“å¼€ Grafana
make stability-monitor

# æˆ–æ‰‹åŠ¨è®¿é—®
# Grafana: http://localhost:3000 (admin/admin)
# Prometheus: http://localhost:9090
# RabbitMQ: http://localhost:15672 (guest/guest)
```

### 4. åœæ­¢æµ‹è¯•

```bash
make stability-down
```

## ğŸ“Š å…¶ä»–æµ‹è¯•ç±»å‹

### é«˜å¹¶å‘å‹åŠ›æµ‹è¯• (1å°æ—¶)

```bash
make stability-high-concurrency
```

æµ‹è¯• 10,000 msg/s çš„é«˜å¹¶å‘åœºæ™¯ã€‚

### ç½‘ç»œæ•…éšœæ¢å¤æµ‹è¯• (2å°æ—¶)

```bash
make stability-network-chaos
```

æ¯ 5 åˆ†é’Ÿæ¨¡æ‹Ÿä¸€æ¬¡ç½‘ç»œæ•…éšœï¼ŒéªŒè¯è‡ªåŠ¨æ¢å¤ã€‚

### å†…å­˜æ³„æ¼æ£€æµ‹ (12å°æ—¶)

```bash
make stability-memory-leak
```

åå¤åˆ›å»º/é”€æ¯æ¶ˆè´¹è€…ï¼Œæ£€æµ‹å†…å­˜å’Œ Goroutine æ³„æ¼ã€‚

è®¿é—® pprof: http://localhost:6060/debug/pprof/

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### Grafana ä»ªè¡¨æ¿

è®¿é—® http://localhost:3000 æŸ¥çœ‹:

- ğŸ“Š æ¶ˆæ¯å‘é€/æ¥æ”¶é€Ÿç‡
- ğŸ“Š é˜Ÿåˆ—æ·±åº¦
- ğŸ“Š è¿æ¥æ•°
- ğŸ“Š å†…å­˜ä½¿ç”¨
- ğŸ“Š Goroutine æ•°é‡

### å®æ—¶æ—¥å¿—

```bash
# æŸ¥çœ‹ç‰¹å®šæµ‹è¯•æ—¥å¿—
docker-compose logs -f stability-long-run

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs -f
```

### æŒ‡æ ‡ç«¯ç‚¹

æ¯ä¸ªæµ‹è¯•å®¹å™¨éƒ½æš´éœ²äº† Prometheus æ ¼å¼çš„æŒ‡æ ‡:

```bash
# é•¿æ—¶é—´æµ‹è¯•æŒ‡æ ‡
curl http://localhost:8080/metrics

# å†…å­˜æ³„æ¼æµ‹è¯• pprof
curl http://localhost:6060/debug/pprof/heap
```

## ğŸ¯ éªŒæ”¶æ ‡å‡†

### é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•

- âœ… è¿è¡Œ 24 å°æ—¶æ— å´©æºƒ
- âœ… å†…å­˜å¢é•¿ < 1MB/hour
- âœ… Goroutine æ•°é‡ç¨³å®š
- âœ… æ¶ˆæ¯ä¸¢å¤±ç‡ = 0%

### é«˜å¹¶å‘å‹åŠ›æµ‹è¯•

- âœ… ååé‡ > 10,000 msg/s
- âœ… P99 å»¶è¿Ÿ < 100ms
- âœ… é”™è¯¯ç‡ < 0.01%

### ç½‘ç»œæ•…éšœæ¢å¤æµ‹è¯•

- âœ… é‡è¿æˆåŠŸç‡ > 99.9%
- âœ… æ¶ˆæ¯ä¸ä¸¢å¤±
- âœ… æ¢å¤æ—¶é—´ < 10s

### å†…å­˜æ³„æ¼æ£€æµ‹

- âœ… Goroutine æ³„æ¼ = 0
- âœ… å†…å­˜å¢é•¿ < 5MB (GC å)

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠ?

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5672
lsof -i :15672

# ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
```

### Q: å®¹å™¨å¯åŠ¨å¤±è´¥?

```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs rabbitmq

# é‡æ–°å¯åŠ¨
make stability-down
make stability-long-run
```

### Q: å¦‚ä½•ä¿®æ”¹æµ‹è¯•å‚æ•°?

ç¼–è¾‘ `docker-compose.yml`:

```yaml
environment:
  TEST_DURATION: 48h      # ä¿®æ”¹æµ‹è¯•æ—¶é•¿
  MESSAGE_RATE: 1000      # ä¿®æ”¹æ¶ˆæ¯é€Ÿç‡
  CONSUMER_COUNT: 20      # ä¿®æ”¹æ¶ˆè´¹è€…æ•°é‡
```

### Q: å¦‚ä½•å¯¼å‡ºæµ‹è¯•ç»“æœ?

```bash
# å¯¼å‡ºæ—¥å¿—
docker-compose logs stability-long-run > test-results.log

# å¯¼å‡º Prometheus æ•°æ®
# è®¿é—® http://localhost:9090/graph å¹¶å¯¼å‡ºæŸ¥è¯¢ç»“æœ
```

## ğŸ“š ä¸‹ä¸€æ­¥

- ğŸ“– é˜…è¯» [å®Œæ•´æµ‹è¯•æŒ‡å—](STABILITY_TEST_README.md)
- ğŸ“– æŸ¥çœ‹ [é›†æˆæµ‹è¯•æ–‡æ¡£](../INTEGRATION_TEST.md)
- ğŸ“– å­¦ä¹  [ç¤ºä¾‹ä»£ç ](../examples/README.md)

## ğŸ’¡ æç¤º

1. **é€æ­¥å¢åŠ è´Ÿè½½**: å…ˆè¿è¡ŒçŸ­æ—¶é—´æµ‹è¯•ï¼Œç¡®è®¤æ— é—®é¢˜åå†è¿è¡Œé•¿æ—¶é—´æµ‹è¯•
2. **ç›‘æ§èµ„æº**: ç¡®ä¿ä¸»æœºæœ‰è¶³å¤Ÿçš„ CPU å’Œå†…å­˜
3. **ä¿å­˜ç»“æœ**: å®šæœŸå¯¼å‡ºæ—¥å¿—å’ŒæŒ‡æ ‡æ•°æ®
4. **å¯¹æ¯”åŸºå‡†**: å»ºç«‹æ€§èƒ½åŸºå‡†ï¼Œå¯¹æ¯”ä¸åŒç‰ˆæœ¬

## ğŸ†˜ è·å–å¸®åŠ©

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# æŸ¥çœ‹è„šæœ¬å¸®åŠ©
./scripts/run-stability-tests.sh --help
```

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰

